@{
    var title = ViewData["Title"] as string ?? "Utilities HR";
    var ctrl = (ViewContext.RouteData.Values["controller"]?.ToString() ?? "").ToLowerInvariant();

    string Active(string c) => ctrl == c.ToLowerInvariant() ? "active" : "";
    string CutiActive() => (ctrl == "cutis" || ctrl == "cutilimits") ? "active" : "";
    string MaterialActive() => (ctrl == "materials" || ctrl == "materialjenis") ? "active" : "";
    string EmployeeActive() => (ctrl == "employees" || ctrl == "employeelookups") ? "active" : "";
    string DinasActive() => (ctrl == "dinas" || ctrl == "jenisdinas") ? "active" : "";
    string SertifikasiActive() => (ctrl == "sertifikasis" || ctrl == "mastersertifikasis") ? "active" : "";
    // Outstanding Pekerjaan + Master Nama Pekerjaan
    string WorkTasksActive() => (ctrl == "worktasks" || ctrl == "workjobnames") ? "active" : "";

    // Hak istimewa: Admin, SuperAdmin, Supervisor
    bool isPrivileged = User.IsInRole("Admin") || User.IsInRole("SuperAdmin") || User.IsInRole("Supervisor");

    // ====== PAGE HEADER (judul + breadcrumb + icon) ======
    var pageTitle = ViewData["Title"] as string ?? title;
    var pageBreadcrumb = ViewData["Breadcrumb"] as string ?? pageTitle;

    string PageIcon()
    {
        return ctrl switch
        {
            "home" => "bi-grid-fill",
            "employees" => "bi-people-fill",
            "employeelookups" => "bi-collection",
            "cutis" => "bi-calendar-check-fill",
            "cutilimits" => "bi-calendar2-range-fill",
            "dinas" => "bi-briefcase-fill",
            "jenisdinas" => "bi-diagram-3-fill",
            "materials" => "bi-box-seam",
            "materialjenis" => "bi-tags-fill",
            "sertifikasis" => "bi-patch-check-fill",
            "mastersertifikasis" => "bi-mortarboard-fill",
            "users" => "bi-people",
            "worktasks" => "bi-list-task",
            "workjobnames" => "bi-card-checklist",
            _ => "bi-grid"
        };
    }
}

<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@title</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.7/css/dataTables.bootstrap5.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/3.0.2/css/responsive.bootstrap5.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />

    @RenderSection("Styles", required: false)

    <style>
        /* ==================== THEME TOKENS ==================== */
        :root {
            --brand-red: #e31e24;
            --brand-blue: #0f7bd9;
            --primary: var(--brand-blue);
            --danger: var(--brand-red);
            --ink: #0f172a;
            --muted: #667085;
            --line: #e5e9f2;
            --bg: #ffffff;
            --soft: #f6f8fb;
            --primary-soft: #eaf3ff;
            --sidebar-w: 260px;
            --topbar-h: 56px;
            --radius-lg: 12px;
            --radius-md: 10px;
            --radius-sm: 8px;
            --shadow: 0 6px 20px rgba(15,23,42,.06);
            /* Typography */
            --fs-base: 13px;
            --fs-sm: 12px;
            --fs-xs: 11px;
            --h1: 18px;
            --h2: 16px;
            --h3: 15px;
            --h4: 14px;
            --h5: 13px;
            --h6: 12px;
        }

        body.dark-mode {
            --ink: #f8fafc;
            --muted: #9fb0c6;
            --line: #2a3446;
            --bg: #1e293b;
            --soft: #0f172a;
            --primary-soft: #173b8f;
            --shadow: 0 6px 20px rgba(0,0,0,.25);
        }

        /* ==================== GLOBAL TYPE ==================== */
        html, body {
            height: 100%;
            min-height: 100vh;
        }

        body {
            font-family: 'Poppins',system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
            font-size: var(--fs-base);
            line-height: 1.45;
            color: var(--ink);
            background: var(--soft);
            transition: background-color .3s,color .3s;
        }

        a {
            text-decoration: none;
        }

        h1, h2, h3, h4, h5, h6,
        .navbar, .btn, .form-control, .form-select,
        .table, .dataTable, .pagination,
        .select2-container, .dropdown-menu, .modal-title, .badge, .input-group-text {
            font-family: 'Poppins',system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif !important;
        }

        h1 {
            font-size: var(--h1);
            font-weight: 700;
            margin-bottom: .75rem;
        }

        h2 {
            font-size: var(--h2);
            font-weight: 600;
            margin-bottom: .6rem;
        }

        h3 {
            font-size: var(--h3);
            font-weight: 600;
            margin-bottom: .5rem;
        }

        h4 {
            font-size: var(--h4);
            font-weight: 600;
        }

        h5 {
            font-size: var(--h5);
            font-weight: 600;
        }

        h6 {
            font-size: var(--h6);
            font-weight: 600;
        }

        .btn {
            font-size: var(--fs-sm);
            border-radius: 10px;
        }

        .btn-sm {
            font-size: var(--fs-xs);
        }

        .form-control, .form-select {
            font-size: var(--fs-sm);
            border-radius: 10px;
        }

        .input-group-text {
            font-size: var(--fs-sm);
            border-radius: 10px;
        }

        .badge {
            font-size: var(--fs-xs);
        }

        .dropdown-item {
            font-size: var(--fs-sm);
        }

        .small, small {
            font-size: var(--fs-xs);
        }

        .table, table.dataTable {
            font-size: var(--fs-sm);
        }

            table.dataTable > thead > tr > th {
                font-weight: 600;
                font-size: var(--fs-sm);
            }

            table.dataTable > tbody > tr > td {
                font-size: var(--fs-sm);
            }

        .dataTables_length label, .dataTables_filter label,
        .dataTables_info, .dataTables_paginate {
            font-size: var(--fs-sm);
        }

        .page-link {
            font-size: var(--fs-sm);
        }

        .page-item .page-link {
            border-radius: 8px;
        }

        .dt-search input {
            font-size: var(--fs-sm);
        }

        .select2-container--bootstrap-5 .select2-selection {
            font-size: var(--fs-sm);
            border-radius: 10px;
            min-height: 38px;
        }

        .select2-container--bootstrap-5 .select2-selection__rendered {
            font-size: var(--fs-sm);
        }

        .select2-container--bootstrap-5 .select2-results__option {
            font-size: var(--fs-sm);
        }

        /* ==================== LOADER OVERLAY ==================== */
        #loader-wrapper {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(15,23,42,.25);
            backdrop-filter: blur(3px);
            z-index: 1100;
            opacity: 0;
            visibility: hidden;
            transition: opacity .25s, visibility .25s;
        }

        #loader-box {
            background: var(--bg);
            border-radius: 16px;
            padding: 18px 22px;
            box-shadow: 0 10px 32px rgba(15,23,42,.25);
            display: flex;
            align-items: center;
            gap: 14px;
            min-width: 260px;
        }

        .loader-spinner {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            border: 3px solid #d0d7e6;
            border-top-color: var(--primary);
            animation: spinLoader 0.9s linear infinite;
        }

        .loader-text-main {
            font-size: 13px;
            font-weight: 600;
            color: var(--ink);
        }

        .loader-text-sub {
            font-size: 11px;
            color: var(--muted);
        }

        @@keyframes spinLoader {
            to {
                transform: rotate(360deg);
            }
        }

        /* ==================== Sidebar ==================== */
        .sidebar-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            width: var(--sidebar-w);
            background: var(--bg);
            border-right: 1px solid var(--line);
            overflow-y: auto;
            z-index: 1000;
            transition: transform .28s ease, box-shadow .28s ease, background-color .3s;
        }

        .sidebar-brand {
            height: var(--topbar-h);
            display: flex;
            align-items: center;
            justify-content: flex-start;
            padding: 0 .9rem;
            border-bottom: 1px solid var(--line);
        }

            .sidebar-brand img {
                height: 32px;
            }

        .sidebar-nav {
            padding: .75rem;
        }

        .nav-heading {
            font-size: var(--fs-xs);
            font-weight: 600;
            color: var(--muted);
            text-transform: uppercase;
            padding: .75rem .5rem .5rem;
            letter-spacing: .3px;
        }

        .sidebar-nav .nav-item {
            margin-bottom: 4px;
        }

        .sidebar-nav .nav-link {
            font-size: var(--fs-sm);
            color: #334e6a;
            font-weight: 500;
            border-radius: var(--radius-sm);
            padding: 10px 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: background-color .15s, color .15s;
        }

            .sidebar-nav .nav-link .bi {
                font-size: 1.05rem;
                color: #7a879a;
                transition: color .15s;
            }

            .sidebar-nav .nav-link:hover {
                background: var(--primary-soft);
                color: var(--primary);
            }

                .sidebar-nav .nav-link:hover .bi {
                    color: var(--primary);
                }

            .sidebar-nav .nav-link.active {
                background: #0a5db0;
                color: #ffffff;
                font-weight: 600;
                box-shadow: 0 2px 8px rgba(10, 93, 176, 0.3);
            }

                .sidebar-nav .nav-link.active .bi {
                    color: #ffffff;
                }

        .submenu {
            padding-left: 38px;
            border-left: 2px dashed var(--line);
            margin: .25rem 0 .5rem .5rem;
        }

            .submenu a {
                display: block;
                padding: 7px 10px;
                border-radius: 8px;
                font-size: var(--fs-sm);
                color: #3b4658;
                transition: background-color .15s, color .15s;
            }

                .submenu a:hover {
                    background: var(--primary-soft);
                    color: var(--primary);
                }

                .submenu a.active {
                    background: #0a5db0;
                    color: #ffffff;
                    font-weight: 500;
                    box-shadow: 0 1px 4px rgba(10, 93, 176, 0.3);
                }

        .employee-toggle .chev,
        .cuti-toggle .chev,
        .material-toggle .chev,
        .dinas-toggle .chev,
        .sertifikasi-toggle .chev,
        .pekerjaan-toggle .chev {
            margin-left: auto;
            transition: transform .2s ease;
        }

        .employee-toggle[aria-expanded="true"] .chev,
        .cuti-toggle[aria-expanded="true"] .chev,
        .material-toggle[aria-expanded="true"] .chev,
        .dinas-toggle[aria-expanded="true"] .chev,
        .sertifikasi-toggle[aria-expanded="true"] .chev,
        .pekerjaan-toggle[aria-expanded="true"] .chev {
            transform: rotate(90deg);
        }

        /* ==================== Content & Topbar ==================== */
        .page-content-wrapper {
            width: calc(100% - var(--sidebar-w));
            margin-left: var(--sidebar-w);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: margin-left .28s ease,width .28s ease;
        }

        .top-navbar {
            height: var(--topbar-h);
            background: var(--bg);
            border-bottom: 1px solid var(--line);
            position: sticky;
            top: 0;
            z-index: 900;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 .75rem;
        }

        .left-cluster {
            display: flex;
            align-items: center;
            gap: .5rem;
        }

        .sidebar-toggler {
            display: none;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 12px;
            border: 1px solid var(--line);
            align-items: center;
            justify-content: center;
        }

            .sidebar-toggler:hover {
                background: var(--primary-soft);
                border-color: transparent;
            }

        #global-search {
            width: 260px;
            max-width: 40vw;
            border: 1px solid var(--line);
            border-radius: 12px;
            height: 36px;
            padding: 0 12px 0 38px;
            font-size: var(--fs-sm);
            background: var(--bg);
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="%23667085" class="bi bi-search" viewBox="0 0 16 16"><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/></svg>');
            background-repeat: no-repeat;
            background-position: 12px center;
            background-size: 16px;
        }

            #global-search:focus {
                outline: 0;
                border-color: var(--primary);
                box-shadow: 0 0 0 .2rem rgba(15,123,217,.15);
            }

        .gs-suggest {
            position: absolute;
            top: calc(100% + 4px);
            left: 0;
            width: 100%;
            max-height: 260px;
            overflow-y: auto;
            background: #ffffff;
            border-radius: 10px;
            border: 1px solid var(--line);
            box-shadow: 0 10px 28px rgba(15,23,42,.12);
            z-index: 999;
            display: none;
        }

        .nav-icons .nav-link {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 12px;
            border: 1px solid var(--line);
            transition: background-color .2s,border-color .2s;
            margin-left: 6px;
        }

            .nav-icons .nav-link:hover {
                background: var(--primary-soft);
                border-color: transparent;
            }

        .nav-icons .bi {
            font-size: 18px;
            line-height: 1;
        }

        .dropdown-menu {
            border: 1px solid var(--line);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow);
            padding: 0.5rem 0;
            min-width: 200px;
        }

        .dropdown-header {
            font-size: var(--fs-sm);
            font-weight: 600;
            color: var(--ink);
            padding: 0.5rem 1rem;
        }

        .dropdown-item {
            padding: 0.5rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: background-color .15s, color .15s;
        }

            .dropdown-item:hover {
                background: var(--primary-soft);
                color: var(--primary);
            }

            .dropdown-item.logout-item {
                color: #dc3545;
            }

                .dropdown-item.logout-item:hover {
                    background: #fff5f5;
                    color: #dc3545;
                }

        .site-footer {
            color: var(--muted);
            font-size: var(--fs-sm);
        }

        .table-responsive {
            border-radius: var(--radius-sm);
            overflow: hidden;
        }

        .action-buttons {
            display: flex;
            gap: 0.25rem;
            justify-content: flex-end;
        }

        .btn-icon {
            width: 32px;
            height: 32px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }

        /* ==================== GLOBAL PAGE HEADER ==================== */
        .page-header-shell {
            margin-top: .35rem; /* dikecilkan supaya konten lebih dekat ke header */
            margin-bottom: .5rem;
        }

        .page-header-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: .75rem;
            padding: .55rem 0 .6rem 0;
            border-bottom: 1px solid var(--line);
            flex-wrap: wrap;
        }

        .ph-left {
            display: flex;
            align-items: center;
            gap: .75rem;
            min-width: 0;
        }

        .ph-icon-circle {
            width: 34px;
            height: 34px;
            border-radius: 999px;
            background: linear-gradient(135deg, #34d399, #0ea5e9);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ffffff;
            box-shadow: 0 4px 10px rgba(59,130,246,.25);
            flex-shrink: 0;
        }

            .ph-icon-circle .bi {
                font-size: 1.1rem;
            }

        .ph-title {
            font-size: 1rem;
            font-weight: 600;
        }

        .ph-breadcrumb {
            font-size: var(--fs-sm);
            color: var(--muted);
        }

            .ph-breadcrumb a {
                color: var(--muted);
            }

            .ph-breadcrumb span.sep {
                margin: 0 .35rem;
            }

        .ph-actions {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: .5rem;
        }

        /* tombol pill global */
        .btn-pill-outline {
            background: #ffffff;
            border-radius: 999px;
            border: 1px solid #d0d7e6;
            color: #0f172a;
            font-size: var(--fs-sm);
            font-weight: 500;
            padding-inline: 1rem;
        }

            .btn-pill-outline i {
                color: #0a5db0;
                font-size: .9rem;
            }

            .btn-pill-outline:hover {
                background: #f3f6fb;
                border-color: #c3cce3;
            }

        .btn-pill-primary {
            border-radius: 999px;
            background: #0f7bd9;
            border-color: #0f7bd9;
            color: #ffffff;
            font-size: var(--fs-sm);
            font-weight: 500;
            padding-inline: 1rem;
            box-shadow: 0 4px 12px rgba(15, 123, 217, .35);
        }

            .btn-pill-primary i {
                color: #ffffff;
                font-size: .9rem;
            }

            .btn-pill-primary:hover {
                background: #0a5db0;
                border-color: #0a5db0;
            }

        /* highlight hasil global search */
        .search-hit {
            animation: searchFlash 1.2s ease-out 1;
            box-shadow: 0 0 0 3px rgba(56,189,248,.55);
        }

        @@keyframes searchFlash {
            0% {
                background-color: #fef3c7;
            }

            100% {
                background-color: transparent;
            }
        }

        /* ==================== RESPONSIVE ==================== */
        @@media (max-width: 575.98px) {
            .modal.modal-bottom .modal-dialog {
                position: fixed;
                margin: 0;
                left: 0;
                right: 0;
                bottom: 0;
                width: 100%;
                max-width: 100%;
                transform: translateY(100%);
                transition: transform .35s cubic-bezier(.21,1,.21,1);
            }

            .modal.modal-bottom.show .modal-dialog {
                transform: translateY(0);
            }

            .modal.modal-bottom .modal-content {
                border-radius: 16px 16px 0 0;
                box-shadow: 0 -8px 28px rgba(15,23,42,.18);
            }

            .modal-backdrop.show {
                opacity: .35;
                backdrop-filter: saturate(140%) blur(2px);
            }

            .modal.modal-bottom .modal-header::before {
                content: "";
                display: block;
                width: 38px;
                height: 4px;
                border-radius: 999px;
                background: #cfd6e4;
                position: absolute;
                left: 50%;
                top: 8px;
                transform: translateX(-50%);
            }

            .page-header-bar {
                align-items: flex-start;
            }
        }

        @@media (max-width: 991.98px) {
            .page-content-wrapper {
                width: 100%;
                margin-left: 0;
            }

            .sidebar-wrapper {
                transform: translateX(-100%);
                box-shadow: none;
            }

            body.sidebar-open .sidebar-wrapper {
                transform: translateX(0);
                box-shadow: 0 0 22px rgba(0,0,0,.18);
            }

            .sidebar-toggler {
                display: inline-flex;
            }

            #global-search {
                width: 180px;
                max-width: 55vw;
            }

            #mobile-overlay {
                display: none;
            }

            body.sidebar-open #mobile-overlay {
                display: block;
            }

            .table-responsive {
                font-size: var(--fs-xs);
            }

            .btn-sm {
                padding: 0.25rem 0.5rem;
                font-size: var(--fs-xs);
            }

            .action-buttons {
                justify-content: center;
            }
        }

        @@media (max-width: 767.98px) {
            .content-card {
                padding: 0.75rem;
            }

            .modal-dialog {
                margin: 0.5rem;
            }
        }

        .sidebar-icon {
            font-size: 20px;
            color: #fff;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 10px;
        }

            .nav-link:not(.active) .sidebar-icon {
                color: #5a6a85;
            }

        #mobile-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,.35);
            z-index: 950;
        }

        .sidebar-toggler:focus,
        .nav-icons .nav-link:focus,
        .sidebar-nav a:focus,
        #global-search:focus {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <!-- LOADER OVERLAY -->
    <div id="loader-wrapper">
        <div id="loader-box">
            <div class="loader-spinner"></div>
            <div>
                <div class="loader-text-main">Sedang memproses data…</div>
                <div class="loader-text-sub">Mohon tunggu, proses ini bisa memakan waktu.</div>
            </div>
        </div>
    </div>

    <div id="mobile-overlay" hidden></div>

    <!-- SIDEBAR -->
    <nav class="sidebar-wrapper" aria-label="Sisi navigasi">
        <div class="sidebar-brand">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e6/Pertamina_Logo.svg/1280px-Pertamina_Logo.svg.png" alt="Pertamina">
        </div>

        <ul class="nav flex-column sidebar-nav">
            <li class="nav-heading">Main Menu</li>

            <li class="nav-item">
                <a class="nav-link @Active("home")" asp-controller="Home" asp-action="Index">
                    <!-- disamakan dengan icon dashboard di content -->
                    <i class="bi bi-grid-fill sidebar-icon"></i>
                    Dashboard
                </a>
            </li>

    
            <!-- PEKERJA -->
            <li class="nav-heading">Pekerja</li>

            <li class="nav-item">
                <a class="nav-link employee-toggle @EmployeeActive()" data-bs-toggle="collapse"
                   href="#menu-employee" role="button"
                   aria-expanded="@(EmployeeActive() == "active" ? "true" : "false")"
                   aria-controls="menu-employee">
                    <i class="bi bi-people-fill"></i> Pekerja
                    <i class="bi bi-chevron-right chev" aria-hidden="true"></i>
                </a>

                <div class="collapse @(EmployeeActive() == "active" ? "show" : "")" id="menu-employee">
                    <div class="submenu">
                        <a class="@Active("employees")" href="/Employees">Data Pekerja</a>
                        @if (isPrivileged)
                        {
                            <a class="@Active("employeelookups")" href="/EmployeeLookups">Master Opsi Pekerja</a>
                        }
                    </div>
                </div>
            </li>

            @if (isPrivileged)
            {
                <li class="nav-heading">Operasional HR</li>

                <li class="nav-item">
                    <a class="nav-link dinas-toggle @DinasActive()" data-bs-toggle="collapse"
                       href="#menu-dinas" role="button"
                       aria-expanded="@(DinasActive() == "active" ? "true" : "false")"
                       aria-controls="menu-dinas">
                        <i class="bi bi-briefcase-fill"></i> Dinas
                        <i class="bi bi-chevron-right chev" aria-hidden="true"></i>
                    </a>
                    <div class="collapse @(DinasActive() == "active" ? "show" : "")" id="menu-dinas">
                        <div class="submenu">
                            <a class="@Active("dinas")" href="/Dinas">Data Dinas</a>
                            <a class="@Active("jenisdinas")" href="/JenisDinas">Master Jenis Dinas</a>
                        </div>
                    </div>
                </li>
            }

            <li class="nav-item">
                <a class="nav-link cuti-toggle @CutiActive()" data-bs-toggle="collapse" href="#menu-cuti" role="button"
                   aria-expanded="@(CutiActive() == "active" ? "true" : "false")" aria-controls="menu-cuti">
                    <i class="bi bi-calendar-check-fill"></i> Cuti
                    <i class="bi bi-chevron-right chev" aria-hidden="true"></i>
                </a>
                <div class="collapse @(CutiActive() == "active" ? "show" : "")" id="menu-cuti">
                    <div class="submenu">
                        <a class="@Active("cutis")" href="/Cutis">Data Cuti</a>
                        @if (isPrivileged)
                        {
                            <a class="@Active("cutilimits")" href="/CutiLimits">Atur Limit Cuti</a>
                        }
                    </div>
                </div>
            </li>

            <!-- OUTSTANDING PEKERJAAN -->
            <li class="nav-heading">Pekerjaan</li>
            <li class="nav-item">
                <a class="nav-link pekerjaan-toggle @WorkTasksActive()" data-bs-toggle="collapse"
                   href="#menu-pekerjaan" role="button"
                   aria-expanded="@(WorkTasksActive() == "active" ? "true" : "false")"
                   aria-controls="menu-pekerjaan">
                    <i class="bi bi-list-task"></i> Outstanding
                    <i class="bi bi-chevron-right chev" aria-hidden="true"></i>
                </a>
                <div class="collapse @(WorkTasksActive() == "active" ? "show" : "")" id="menu-pekerjaan">
                    <div class="submenu">
                        <a class="@Active("worktasks")" href="/WorkTasks">Outstanding Pekerjaan</a>
                        @if (isPrivileged)
                        {
                            <a class="@Active("workjobnames")" href="/WorkJobNames">Master Nama Pekerjaan</a>
                        }
                    </div>
                </div>
            </li>


            @if (isPrivileged)
            {
                <li class="nav-heading">Material</li>
                <li class="nav-item">
                    <a class="nav-link material-toggle @MaterialActive()" data-bs-toggle="collapse" href="#menu-material" role="button"
                       aria-expanded="@(MaterialActive() == "active" ? "true" : "false")" aria-controls="menu-material">
                        <i class="bi bi-box-seam"></i> Material Utilities
                        <i class="bi bi-chevron-right chev" aria-hidden="true"></i>
                    </a>
                    <div class="collapse @(MaterialActive() == "active" ? "show" : "")" id="menu-material">
                        <div class="submenu">
                            <a class="@Active("materials")" href="/Materials">Data Material</a>
                            <a class="@Active("materialjenis")" href="/MaterialJenis">Jenis Barang</a>
                        </div>
                    </div>
                </li>
            }

            <li class="nav-heading">Sertifikasi</li>
            <li class="nav-item">
                <a class="nav-link sertifikasi-toggle @SertifikasiActive()" data-bs-toggle="collapse"
                   href="#menu-sertifikasi" role="button"
                   aria-expanded="@(SertifikasiActive() == "active" ? "true" : "false")"
                   aria-controls="menu-sertifikasi">
                    <i class="bi bi-patch-check-fill"></i> Sertifikasi
                    <i class="bi bi-chevron-right chev" aria-hidden="true"></i>
                </a>
                <div class="collapse @(SertifikasiActive() == "active" ? "show" : "")" id="menu-sertifikasi">
                    <div class="submenu">
                        <a class="@Active("sertifikasis")" href="/Sertifikasis">Data Sertifikasi</a>
                        @if (isPrivileged)
                        {
                            <a class="@Active("mastersertifikasis")" href="/MasterSertifikasis">Master Sertifikasi</a>
                        }
                    </div>
                </div>
            </li>
               @if (isPrivileged)
            {
                <li class="nav-heading">Akun</li>
                <li class="nav-item">
                    <a class="nav-link @Active("users")" asp-controller="Users" asp-action="Index">
                    <i class="bi bi-people"></i> Manajemen Akun
                </a>
            </li>
            }
        </ul>
    </nav>

    <!-- CONTENT -->
    <div class="page-content-wrapper">
        <nav class="top-navbar" aria-label="Bilah atas">
            <div class="left-cluster position-relative">
                <button class="sidebar-toggler" id="sidebar-toggler" aria-label="Buka tutup menu" aria-expanded="false">
                    <i class="bi bi-list"></i>
                </button>
                <div class="position-relative" style="min-width:220px;">
                    <input id="global-search" type="search" placeholder="Cari menu / konten…" autocomplete="off" />
                    <div id="gs-suggest" class="gs-suggest" role="listbox"></div>
                </div>
            </div>

            <div class="nav-icons d-flex align-items-center justify-content-end">
                <a class="nav-link" id="fullscreen-toggle" title="Layar Penuh" aria-label="Layar penuh" href="#" role="button">
                    <i class="bi bi-arrows-fullscreen"></i>
                </a>

                <a class="nav-link" id="theme-toggle" role="button" aria-label="Ganti tema" aria-pressed="false" title="Tema" href="#">
                    <i class="bi bi-moon-stars-fill" id="theme-icon"></i>
                </a>

                <div class="dropdown">
                    <a class="nav-link" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Akun" href="#" role="button">
                        <i class="bi bi-person-circle"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end mt-2">
                        <li>
                            <h6 class="dropdown-header">
                                <i class="bi bi-person-fill me-2"></i>@User.Identity?.Name
                            </h6>
                        </li>
                        <li><a class="dropdown-item" href="/Profile"><i class="bi bi-person me-2"></i>Edit Profil</a></li>
                        @if (isPrivileged)
                        {
                            <li><a class="dropdown-item" href="/Users"><i class="bi bi-gear me-2"></i>Manajemen Akun</a></li>
                        }
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <button class="dropdown-item logout-item" type="button" onclick="confirmLogout()">
                                <i class="bi bi-box-arrow-right me-2"></i>Logout
                            </button>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <main class="container mt-2 mb-3 flex-grow-1">
            <!-- PAGE HEADER (judul + breadcrumb + tombol aksi sejajar) -->
            <div class="page-header-shell">
                <div class="page-header-bar">
                    <div class="ph-left">
                        <div class="ph-icon-circle">
                            <i class="bi @PageIcon()"></i>
                        </div>
                        <div>
                            <div class="ph-title">@pageTitle</div>
                            <div class="ph-breadcrumb">
                                <a href="/">Home</a>
                                <span class="sep">›</span>
                                <span>@pageBreadcrumb</span>
                            </div>
                        </div>
                    </div>

                    @if (IsSectionDefined("PageActions"))
                    {
                        <div class="ph-actions ms-auto">
                            @RenderSection("PageActions", required: false)
                        </div>
                    }
                </div>
            </div>

            @RenderBody()
        </main>

        <div class="site-footer text-center mt-auto pb-3 px-4">
            © @DateTime.Now.Year Utilities HR · PT KPI — Utilities Department
        </div>
    </div>

    <!-- Modal AJAX -->
    <div class="modal fade" id="ajax-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" style="border-radius:var(--radius-md)">
                <div class="modal-header" style="border-bottom:1px solid var(--line)">
                    <h5 class="modal-title"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
                </div>
                <div class="modal-body"></div>
            </div>
        </div>
    </div>

    <!-- Form Logout (tersembunyi) -->
    <form id="logout-form" asp-controller="Account" asp-action="Logout" method="post" style="display: none;">
        @Html.AntiForgeryToken()
    </form>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/2.0.7/js/dataTables.js"></script>
    <script src="https://cdn.datatables.net/2.0.7/js/dataTables.bootstrap5.js"></script>
    <script src="https://cdn.datatables.net/responsive/3.0.2/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        /* ===== THEME ===== */
        (function initTheme() {
            const saved = localStorage.getItem('theme');
            if (saved === 'dark') {
                document.body.classList.add('dark-mode');
                setThemeIcon('dark');
            } else {
                setThemeIcon('light');
            }
        })();

        function setThemeIcon(mode) {
            const i = document.getElementById('theme-icon');
            const t = document.getElementById('theme-toggle');
            if (mode === 'dark') {
                i.className = 'bi bi-sun-fill';
                t.setAttribute('aria-pressed', 'true');
            } else {
                i.className = 'bi bi-moon-stars-fill';
                t.setAttribute('aria-pressed', 'false');
            }
        }

        /* ===== SIDEBAR / LAYOUT ===== */
        const $body = $('body'), $overlay = $('#mobile-overlay');
        const mm = window.matchMedia('(max-width: 991.98px)');

        $('#sidebar-toggler').on('click', function (e) {
            e.preventDefault();
            const open = !$body.hasClass('sidebar-open');
            $body.toggleClass('sidebar-open', open);
            $(this).attr('aria-expanded', open ? 'true' : 'false');
            if (open) $overlay.removeAttr('hidden'); else $overlay.attr('hidden', '');
        });

        $overlay.on('click', function () {
            $body.removeClass('sidebar-open');
            $('#sidebar-toggler').attr('aria-expanded', 'false');
            $overlay.attr('hidden', '');
        });

        window.addEventListener('resize', () => {
            if (!mm.matches) {
                $body.removeClass('sidebar-open');
                $('#sidebar-toggler').attr('aria-expanded', 'false');
                $overlay.attr('hidden', '');
            }
        });

        $('#theme-toggle').on('click', function (e) {
            e.preventDefault();
            $body.toggleClass('dark-mode');
            const mode = $body.hasClass('dark-mode') ? 'dark' : 'light';
            localStorage.setItem('theme', mode);
            setThemeIcon(mode);
        });

        $('#fullscreen-toggle').on('click', function (e) {
            e.preventDefault();
            if (!document.fullscreenElement) document.documentElement.requestFullscreen();
            else document.exitFullscreen?.();
        });

        /* ===== LOADER GLOBAL ===== */
        const loaderEl = document.getElementById('loader-wrapper');
        let loaderTimer = null;

        window.showLoader = function (delayMs = 0) {
            if (!loaderEl) return;
            if (loaderTimer) { clearTimeout(loaderTimer); loaderTimer = null; }

            if (delayMs <= 0) {
                loaderEl.style.visibility = 'visible';
                loaderEl.style.opacity = '1';
            } else {
                loaderTimer = setTimeout(() => {
                    loaderEl.style.visibility = 'visible';
                    loaderEl.style.opacity = '1';
                }, delayMs);
            }
        };

        window.hideLoader = function () {
            if (!loaderEl) return;
            if (loaderTimer) { clearTimeout(loaderTimer); loaderTimer = null; }
            loaderEl.style.opacity = '0';
            loaderEl.style.visibility = 'hidden';
        };

        /* ===== SweetAlert helpers ===== */
        window.toast = (msg, icon = 'info') => Swal.fire({
            toast: true,
            position: 'top-end',
            timer: 2500,
            showConfirmButton: false,
            icon,
            title: msg
        });

        window.alertSwal = (title, text, icon = 'warning') => Swal.fire({
            title, text, icon, confirmButtonText: 'OK'
        });

        window.confirmSwal = (title, text, confirmText = 'Ya', cancelText = 'Batal', icon = 'question') => {
            return Swal.fire({
                title, text, icon,
                showCancelButton: true,
                confirmButtonText: confirmText,
                cancelButtonText: cancelText,
                confirmButtonColor: '#0a5db0',
                cancelButtonColor: '#6c757d'
            });
        };

        function confirmLogout() {
            window.confirmSwal(
                'Konfirmasi Logout',
                'Apakah Anda yakin ingin keluar dari sistem?',
                'Ya, Logout',
                'Batal',
                'warning'
            ).then((result) => {
                if (result.isConfirmed) {
                    document.getElementById('logout-form').submit();
                }
            });
        }

        window.handleFetchError = (error, defaultMsg = 'Terjadi kesalahan sistem') => {
            console.error('Fetch error:', error);
            if (error.name === 'AbortError') return;
            window.toast(defaultMsg, 'error');
        };

        /* ===== Mobile bottom-sheet ===== */
        function applyMobileSheet() {
            const mq = window.matchMedia('(max-width: 575.98px)');
            const update = () => {
                document.querySelectorAll('.modal').forEach(m => {
                    if (mq.matches) m.classList.add('modal-bottom');
                    else m.classList.remove('modal-bottom');
                });
            };
            update();
            mq.addEventListener('change', update);

            document.addEventListener('click', (e) => {
                if (!e.target.closest('.modal,.modal-backdrop')) {
                    const opened = document.querySelectorAll('.modal.show');
                    opened.forEach(x => bootstrap.Modal.getOrCreateInstance(x).hide());
                }
            });

            window.addEventListener('beforeunload', () => {
                document.querySelectorAll('.modal.show').forEach(x => {
                    try { bootstrap.Modal.getOrCreateInstance(x).hide(); } catch { }
                });
            });
        }
        applyMobileSheet();

        // Global AJAX error handler
        $(document).ajaxError(function (event, jqXHR) {
            if (jqXHR.status === 404) {
                window.toast('Halaman tidak ditemukan', 'error');
            } else if (jqXHR.status === 500) {
                window.toast('Terjadi kesalahan server', 'error');
            }
        });

        /* ===== GLOBAL SEARCH: cari konten di halaman & scroll ===== */
        (function initGlobalContentSearch() {
            const $input = $('#global-search');
            if (!$input.length) return;

            function doSearch() {
                const q = ($input.val() || '').trim().toLowerCase();
                if (!q) return;

                const $root = $('.page-content-wrapper main');
                if (!$root.length) return;

                // hapus highlight sebelumnya
                $root.find('.search-hit').removeClass('search-hit');

                const $targets = $root.find('h1,h2,h3,h4,h5,h6,th,td,label,p,span,a,button,li');
                let $found = null;

                $targets.each(function () {
                    const text = ($(this).text() || '').trim().toLowerCase();
                    if (text && text.indexOf(q) !== -1) {
                        $found = $(this);
                        return false; // break
                    }
                });

                if ($found && $found.length) {
                    $found.addClass('search-hit');
                    const offsetTop = $found.offset().top - 80; // kompensasi topbar
                    $('html, body').animate({ scrollTop: offsetTop }, 400);
                } else {
                    window.toast('Konten tidak ditemukan.', 'info');
                }
            }

            $input.on('keydown', function (e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    doSearch();
                }
            });
        })();

           /* ===== GLOBAL POPUP EDIT PEKERJA (untuk first login, dll) ===== */
        window.openEmployeeEdit = function (id) {
            if (!id) return;

            const $modal = $('#ajax-modal');
            if (!$modal.length) return;

            const $modalBody = $modal.find('.modal-body');
            const $modalTitle = $modal.find('.modal-title');

            $modalTitle.text('Lengkapi Data Pekerja');
            $modalBody.html('<div class="p-4 text-center text-muted">Memuat data pekerja…</div>');

            const modalInstance = bootstrap.Modal.getOrCreateInstance('#ajax-modal');
            modalInstance.show();

            $.get('@Url.Action("Edit", "Employees")', { id: id })
                .done(function (html) {
                    $modalBody.html(html);
                })
                .fail(function () {
                    $modalBody.html('<div class="p-4 text-danger text-center">Gagal memuat form pekerja. Coba lagi.</div>');
                });
        };

        // Auto popup kalau URL punya ?firstEditId=123
        (function () {
            try {
                const params = new URLSearchParams(window.location.search);
                const firstEditId = parseInt(params.get('firstEditId') || '0');
                if (firstEditId && firstEditId > 0) {
                    setTimeout(function () {
                        if (window.openEmployeeEdit) {
                            window.openEmployeeEdit(firstEditId);
                        }
                    }, 600); // kasih jeda sedikit biar layout sudah siap
                }
            } catch (err) {
                console.error('Error auto popup firstEditId', err);
            }
        })();
    </script>

    @RenderSection("Scripts", required: false)
</body>
</html>
